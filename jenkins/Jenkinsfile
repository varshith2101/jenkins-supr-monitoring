pipeline {
    agent any

    stages {
        stage('Stage 1: Checkout') {
            steps {
                echo 'Stage 1: Checking out code...'
                sleep 2
                echo 'Stage 1: Complete'
            }
        }

        stage('Stage 2: Build') {
            steps {
                echo 'Stage 2: Building application...'
                sleep 3
                echo 'Stage 2: Build successful'
            }
        }

        stage('Stage 3: Test') {
            steps {
                echo 'Stage 3: Running tests...'
                sleep 4
                echo 'Stage 3: All tests passed'
            }
        }

        stage('Stage 4: Deploy') {
            steps {
                echo 'Stage 4: Deploying application...'
                sleep 5
                echo 'Stage 4: Deployment successful'

                script {
                    def random = new Random()
                    def success = random.nextInt(10) > 2

                    if (success) {
                        echo 'Stage 4: DEPLOYMENT COMPLETED SUCCESSFULLY'
                    } else {
                        echo 'Stage 4: DEPLOYMENT ENCOUNTERED ISSUES'
                        error('Deployment failed - simulated failure')
                    }
                }
            }
        }

        stage('Stage 5: Verification') {
            steps {
                echo 'Stage 5: Verifying deployment...'
                sleep 2
                echo 'Stage 5: Verification complete'
            }
        }
    }

    post {
        success {
            echo 'Pipeline completed successfully!'
        }
        failure {
            echo 'Pipeline failed!'
        }
        always {
            echo 'Pipeline execution finished.'
        }
    }
}
